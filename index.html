<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Abril & Pablo ‚Äî Invitaci√≥n</title>

  <!-- Fonts: Poppins (base), Great Vibes (rom√°ntica), Dancing Script (subt√≠tulos) -->
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Dancing+Script:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    /* =========================
       Variables / Reset
       ========================= */
    :root{
      --bg-cream:#F8F5F0;
      --accent:#B8DDE6;
      --deep:#2B2A2F;
      --card-bg: rgba(255,255,255,0.90);
      --rose-gold:#d6a79b;
      --glass-shadow: 0 10px 35px rgba(0,0,0,0.12);
      --count-glow: rgba(102,201,255,0.18);
      --white:#ffffff;
      --muted:#6b6b6b;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;width:100%;font-family:'Poppins',system-ui,Arial,Helvetica,sans-serif;background:var(--bg-cream);color:var(--deep);-webkit-font-smoothing:antialiased;overflow:hidden;cursor:none}
    a{color:inherit}
    img{display:block;max-width:100%}
    button{font-family:inherit;border:0;background:none;cursor:pointer}
    /* hide focus outlines visually custom for accessibility */
    :focus{outline:2px dashed rgba(0,0,0,0.08);outline-offset:3px}

    /* =========================
       Layout / Sections
       ========================= */
    .sections{position:relative;height:100vh;perspective:1400px;overflow:hidden}
    .section{
      position:absolute;inset:0;
      display:flex;align-items:center;justify-content:center;
      padding:36px 18px;
      transition:transform .9s cubic-bezier(.2,.9,.2,1),opacity .6s ease;
      transform-origin:center;backface-visibility:hidden;
      opacity:0;
      background-size:cover;background-position:center;background-attachment:fixed;
    }
    .section.active{opacity:1;transform:rotateY(0) translateZ(0)}
    .section.prev{opacity:0;transform:rotateY(-90deg) translateZ(-240px)}
    .section.next{opacity:0;transform:rotateY(90deg) translateZ(-240px)}

    /* Backgrounds (user images; cover) */
    .portada{background-image:url('fondo_floral.jpg')}
    .page2{background-image:url('fondo_floral1.png')}
    .page3{background-image:url('fondo_floral2.jpg')}
    .page4{background-image:url('fondo_floral3.jpg')}
    .page5{background-image:url('fondo_floral3.jpg')}
    .final{background-image:url('fondo_floral4.png')}

    /* overlay to soften backgrounds */
    .overlay{position:absolute;inset:0;background:linear-gradient(180deg, rgba(255,255,255,0.36), rgba(255,255,255,0.7));pointer-events:none}

    /* central card */
    .card{
      position:relative;z-index:2;
      width:100%;max-width:980px;
      background:var(--card-bg);
      padding:28px;border-radius:18px;
      box-shadow:var(--glass-shadow);
      backdrop-filter:blur(6px);
      display:flex;flex-direction:column;align-items:center;gap:18px;
    }

    /* typography */
    .headline{font-family:'Great Vibes',cursive;font-size:64px;margin:4px 0 0;color:#2f2f2f;text-align:center}
    .sub{font-family:'Dancing Script',cursive;font-size:36px;margin:0;color:#3d3d3d;text-align:center}
    .body-serif{font-family:'Poppins',sans-serif;font-size:16px;color:var(--deep);text-align:center}
    .verse{font-family:'Dancing Script',cursive;font-size:18px;color:#3d3d3d;text-align:center}
    .muted{color:var(--muted);font-size:13px}

    /* ring button (portada) */
    .ring-button{background:transparent;border:0;padding:0;margin:6px auto;position:relative;cursor:pointer}
    .ring-svg{width:240px;height:240px;display:block}
    .ring-rotate{animation:ringSpin 14s linear infinite;transform-origin:100px 100px}
    @keyframes ringSpin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    .ring-spark{position:absolute;left:50%;top:36%;width:140px;height:140px;transform:translate(-50%,-50%);border-radius:50%;pointer-events:none;opacity:0}
    .ring-button.clicked .ring-spark{animation:spark 900ms ease-out forwards}
    @keyframes spark{0%{opacity:0;transform:translate(-50%,-50%) scale(0.6)}30%{opacity:1;transform:translate(-50%,-50%) scale(1.05)}100%{opacity:0;transform:translate(-50%,-50%) scale(1.6)}}

    /* controls */
    .controls-row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:6px}
    .magicBtn{
      padding:8px 14px;border-radius:12px;background:linear-gradient(45deg,var(--white),#B8DDE6);
      color:#2B2A2F;font-weight:600;cursor:pointer;box-shadow:0 8px 22px rgba(0,0,0,0.10);
      border:1px solid rgba(0,0,0,0.04)
    }
    .magicBtn.small{padding:6px 10px;font-size:13px}

    /* parents layout */
    .parents-grid{display:flex;gap:28px;align-items:center;width:100%;justify-content:space-between;margin-bottom:6px}
    .parents-grid .col{flex:1;min-width:200px}
    .parent-names{font-family:'Great Vibes',cursive;font-size:26px;line-height:1.2;color:#2B2A2F}
    .parent-left{text-align:left}
    .parent-right{text-align:right}
    .honor{font-family:'Dancing Script',cursive;font-size:22px;text-align:center;margin-top:8px;color:#2b2b2b}

    /* couple */
    .couple{display:flex;flex-direction:column;align-items:center;gap:14px}
    .photo{max-width:520px;width:100%;height:auto;border-radius:14px;box-shadow:0 12px 36px rgba(0,0,0,0.12);object-fit:cover}

    /* itinerary */
    .itinerary{display:flex;flex-direction:column;gap:12px;width:100%;max-width:820px}
    .it-item{display:flex;gap:12px;align-items:flex-start}
    .it-icon{width:48px;height:48px;border-radius:10px;background:rgba(255,255,255,0.9);display:flex;align-items:center;justify-content:center;font-size:22px}

    /* gallery */
    .gallery-grid{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}
    .gallery-grid img{width:160px;height:110px;object-fit:cover;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.12);transition:transform .25s}
    .gallery-grid img:hover{transform:scale(1.05)}

    /* carousel */
    .carousel-container{display:flex;flex-direction:column;align-items:center;gap:14px;width:100%}
    .carousel-container img{max-width:640px;width:100%;border-radius:14px;box-shadow:0 14px 40px rgba(0,0,0,0.14);object-fit:cover}
    .carousel-controls{display:flex;gap:12px;align-items:center;justify-content:center}

    /* modal RSVP */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,0.56);display:none;align-items:center;justify-content:center;z-index:9999;padding:18px}
    .modal.open{display:flex}
    .modal .box{background:var(--white);padding:18px;border-radius:12px;max-width:560px;width:100%;box-shadow:0 10px 30px rgba(0,0,0,0.18)}

    /* flip countdown */
    .countdown{display:flex;gap:14px;align-items:end;justify-content:center;margin-top:10px}
    .flip-box{display:flex;flex-direction:column;align-items:center;gap:8px}
    .flip-card{width:90px;height:76px;position:relative;perspective:900px}
    .flip-card .card-inner{position:absolute;inset:0;transform-style:preserve-3d;transition:transform .65s cubic-bezier(.2,.9,.2,1)}
    .flip-card .face{
      position:absolute;left:0;right:0;display:flex;align-items:center;justify-content:center;
      font-family:'Dancing Script',cursive;font-size:20px;font-weight:700;color:#012a55;background:rgba(255,255,255,0.95);border-radius:12px;box-shadow:0 0 16px var(--count-glow);
    }
    .flip-card .face.top{top:0;height:50%;border-bottom:1px solid rgba(0,0,0,0.06);transform-origin:bottom}
    .flip-card .face.bottom{bottom:0;height:50%;border-top:1px solid rgba(0,0,0,0.06);transform-origin:top;transform:translateY(50%)}
    .flip-card.flipping .card-inner{transform:rotateX(-180deg)}
    .count-label{font-size:12px;color:#666}

    /* hearts */
    .magicHeart{position:fixed;pointer-events:none;z-index:99999;width:26px;height:26px;opacity:0;transform:translate(-50%,-50%) scale(1);animation:heartFade 1000ms forwards}
    @keyframes heartFade{0%{opacity:1;transform:translate(-50%,-50%) scale(1)}100%{opacity:0;transform:translate(-50%,-120%) scale(0.6)}}

    /* small screens */
    @media (max-width:900px){
      .headline{font-size:46px}
      .sub{font-size:28px}
      .parent-names{font-size:20px}
      .flip-card{width:66px;height:56px}
      .carousel-container img{max-width:420px}
      .card{padding:18px}
    }
  </style>
</head>
<body>

  <!-- Audios (must exist in same folder) -->
  <audio id="marcha" src="marcha_nupcial.mp3" preload="auto" loop autoplay></audio>
  <audio id="eternamente" src="eternamente.mp3" preload="auto"></audio>

  <!-- Sections -->
  <div class="sections" id="sections">

    <!-- -----------------------
         Page 1 - Portada
         ----------------------- -->
    <section class="section portada active" data-name="portada" aria-label="Portada">
      <div class="overlay" aria-hidden="true"></div>
      <div class="card">
        <h1 class="headline">Abril & Pablo</h1>
        <h2 class="sub">¬°S√≠, acepto!</h2>

        <button class="ring-button" id="ringBtn" aria-label="Abrir invitaci√≥n">
          <div class="ring-spark" aria-hidden="true"></div>
          <svg class="ring-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <defs>
              <radialGradient id="ringMetal" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#e9eef2"/><stop offset="60%" stop-color="#c9ccd0"/><stop offset="100%" stop-color="var(--rose-gold)"/></radialGradient>
              <radialGradient id="blueGem" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#dff6ff"/><stop offset="60%" stop-color="#66c9ff"/><stop offset="100%" stop-color="#004c99"/></radialGradient>
            </defs>
            <g class="ring-rotate">
              <ellipse cx="100" cy="100" rx="40" ry="12" stroke="url(#ringMetal)" stroke-width="12" fill="none" />
              <path d="M100 58 L110 70 L100 86 L90 70 Z" fill="url(#blueGem)" stroke="#fff" stroke-opacity="0.4" stroke-width="0.6"/>
              <circle cx="100" cy="60" r="2" fill="#fff" opacity="0.9"></circle>
            </g>
          </svg>
        </button>

        <div class="controls-row" role="group" aria-label="Controles portada">
          <button class="magicBtn" id="clickRingBtn">Clic en el anillo</button>
          <button class="magicBtn" id="pauseMarchBtn">Pausar marcha</button>
          <button class="magicBtn" id="toggleEtern">Reproducir eternamente</button>
        </div>

        <p class="verse">"Quien halla esposa halla el bien" ‚Äî <strong>Proverbios 18:22</strong></p>
      </div>
    </section>

    <!-- -----------------------
         Page 2 - Padres + Novios
         ----------------------- -->
    <section class="section page2" data-name="page2" aria-label="Padres y novios">
      <div class="overlay" aria-hidden="true"></div>
      <div class="card" role="region">
        <div style="width:100%;">
          <div class="parents-grid" id="parentsGrid">
            <div class="col parent-left">
              <p class="parent-names">Padres de la novia<br><strong>Eva Aguilar Rend√≥n</strong><br><strong>Pedro P√©rez Hern√°ndez</strong></p>
            </div>
            <div class="col parent-right">
              <p class="parent-names">Padres del novio<br><strong>Saray Hern√°ndez Santana</strong><br><strong>Pablo Tinoco Carranza</strong> <span title="Finado" style="font-size:18px;color:#444">‚úù</span></p>
            </div>
          </div>

          <div class="honor" style="margin-top:12px">Tienen el honor de compartir la dicha que enlaza a sus amados hijos.</div>
        </div>

        <div class="couple" style="margin-top:10px">
          <h2 class="sub">Abril & Pablo</h2>
          <img src="foto1.jpg" alt="Abril y Pablo" class="photo" id="photo1">
        </div>
      </div>
    </section>

    <!-- -----------------------
         Page 3 - Itinerario + RSVP + Contador
         ----------------------- -->
    <section class="section page3" data-name="page3" aria-label="Itinerario">
      <div class="overlay" aria-hidden="true"></div>
      <div class="card" role="region">
        <h2 class="sub">Itinerario</h2>

        <div class="itinerary" style="margin-top:6px">
          <div class="it-item"><div class="it-icon" aria-hidden="true">‚õ™</div><div><strong>Ceremonia Religiosa:</strong> <strong>2:00 pm</strong> ‚Äî Iglesia Cristiana Palabra de Vida AD<br><a class="muted" href="https://maps.app.goo.gl/AWYkNZ44jyshjRUG6" target="_blank" rel="noopener">Ver mapa</a></div></div>

          <div class="it-item"><div class="it-icon" aria-hidden="true">üéâ</div><div><strong>Recepci√≥n:</strong> <strong>4:00 pm</strong> ‚Äî Jard√≠n Los Abuelos, Tlaquiltenango, Morelos<br><a class="muted" href="https://maps.app.goo.gl/B2W65gnaMnyodGh56" target="_blank" rel="noopener">Ver mapa</a></div></div>

          <div class="it-item"><div class="it-icon" aria-hidden="true">‚è≥</div><div><strong>Duraci√≥n estimada:</strong> Inicio 4:00 pm ‚Äî Se estima evento hasta las 11:00 pm aprox.</div></div>

          <div class="it-item"><div class="it-icon" aria-hidden="true">üëó</div><div><strong>C√≥digo de vestimenta:</strong> Formal ‚Äî tonos recomendados: celestes, beige, gris, verde, rosa.<br><em>Dejemos el blanco para la novia.</em></div></div>
        </div>

        <div style="margin-top:12px">
          <button class="magicBtn" id="openRsvp">Confirmar asistencia</button>
        </div>

        <h3 class="sub" style="margin-top:12px">28 de diciembre del 2025</h3>

        <!-- Flip countdown -->
        <div class="countdown" id="flipCountdown" aria-live="polite" aria-atomic="true">
          <div class="flip-box" aria-hidden="false">
            <div class="flip-card" id="daysCard" aria-hidden="false">
              <div class="card-inner">
                <div class="face top" id="daysTop">00</div>
                <div class="face bottom" id="daysBottom">00</div>
              </div>
            </div>
            <div class="count-label">D√≠as</div>
          </div>

          <div class="flip-box">
            <div class="flip-card" id="hoursCard" aria-hidden="false">
              <div class="card-inner">
                <div class="face top" id="hoursTop">00</div>
                <div class="face bottom" id="hoursBottom">00</div>
              </div>
            </div>
            <div class="count-label">Horas</div>
          </div>

          <div class="flip-box">
            <div class="flip-card" id="minutesCard" aria-hidden="false">
              <div class="card-inner">
                <div class="face top" id="minutesTop">00</div>
                <div class="face bottom" id="minutesBottom">00</div>
              </div>
            </div>
            <div class="count-label">Minutos</div>
          </div>

          <div class="flip-box">
            <div class="flip-card" id="secondsCard" aria-hidden="false">
              <div class="card-inner">
                <div class="face top" id="secondsTop">00</div>
                <div class="face bottom" id="secondsBottom">00</div>
              </div>
            </div>
            <div class="count-label">Segundos</div>
          </div>
        </div>
      </div>
    </section>

    <!-- -----------------------
         Page 4 - Galer√≠a novios (carrusel)
         ----------------------- -->
    <section class="section page4" data-name="page4" aria-label="Galer√≠a novios">
      <div class="overlay" aria-hidden="true"></div>
      <div class="card carousel-container" role="region">
        <h2 class="sub">Galer√≠a ‚Äî Los novios</h2>
        <img src="foto1.jpg" alt="Abril y Pablo" id="carouselImage" class="carousel-image" />
        <div class="carousel-controls" style="margin-top:8px">
          <button class="magicBtn small" id="carouselPrev" aria-label="Anterior foto">Anterior</button>
          <button class="magicBtn small" id="carouselNext" aria-label="Siguiente foto">Siguiente</button>
          <button class="magicBtn small" id="galleryAutoplayToggle" aria-pressed="false">Pausar autoplay</button>
        </div>
      </div>
    </section>

    <!-- -----------------------
         Page 5 - Galer√≠a colaborativa
         ----------------------- -->
    <section class="section page5" data-name="page5" aria-label="Galer√≠a invitados">
      <div class="overlay" aria-hidden="true"></div>
      <div class="card" role="region">
        <h2 class="sub">Momentos de los invitados</h2>
        <div class="gallery-grid" id="guestGallery" style="margin-top:10px">
          <img src="momento8.jpg" alt="Momento invitado 1">
          <img src="foto1.jpg" alt="Momento invitado 2">
        </div>
        <p class="muted" style="text-align:center;margin-top:12px">Comparte tus fotos: <a href="https://docs.google.com/forms/d/e/1FAIpQLSfDX9Ky8YrQ962Uxh5ibEYGDk2WsyyVUxUPC09IcwrBKlHx7A/viewform?usp=header" target="_blank" rel="noopener">Subir momento</a></p>
      </div>
    </section>

    <!-- -----------------------
         Page 6 - Momento final
         ----------------------- -->
    <section class="section final" data-name="final" aria-label="Final">
      <div class="overlay" aria-hidden="true"></div>
      <div class="card couple" role="region">
        <img src="momento8.jpg" alt="Momento especial" class="photo" />
        <h2 class="sub">‚ÄúY as√≠ comienza nuestra historia para siempre‚Äù</h2>
        <div style="display:flex;gap:10px;margin-top:10px;flex-wrap:wrap;justify-content:center">
          <a class="magicBtn small" href="#" id="addCalendar">Agregar al calendario</a>
          <button class="magicBtn small" id="downloadPdf">Descargar invitaci√≥n (PDF)</button>
        </div>

        <div style="display:flex;gap:8px;margin-top:12px;justify-content:center">
          <a class="magicBtn small" href="https://wa.me/5217774914500" target="_blank" rel="noopener">WhatsApp Abril</a>
          <a class="magicBtn small" href="https://wa.me/5217341123645" target="_blank" rel="noopener">WhatsApp Pablo</a>
        </div>
      </div>
    </section>

  </div>

  <!-- RSVP Modal -->
  <div class="modal" id="rsvpModal" role="dialog" aria-modal="true" aria-labelledby="rsvpTitle">
    <div class="box">
      <h3 id="rsvpTitle">Confirmaci√≥n de asistencia</h3>
      <form id="rsvpForm" style="display:flex;flex-direction:column;gap:8px;margin-top:10px">
        <label>Nombre completo<br><input name="name" required style="width:100%;padding:10px;border-radius:8px;border:1px solid #e6e6e6"></label>
        <label>Correo (opcional)<br><input name="email" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e6e6e6"></label>
        <label>N√∫mero de acompa√±antes<br><input name="guests" type="number" min="0" value="0" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e6e6e6"></label>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px">
          <button type="button" class="magicBtn" id="closeRsvp">Cancelar</button>
          <button type="submit" class="magicBtn">Enviar</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    /* ============================
       Basic section navigation (flipbook)
       - showSectionByIndex manages classes active/prev/next
       - keyboard arrows and ring / next click navigate
       ============================ */
    const sections = Array.from(document.querySelectorAll('.section'));
    let currentIndex = 0;

    function showSectionByIndex(idx){
      if(idx < 0) idx = 0;
      if(idx > sections.length - 1) idx = sections.length -1;
      sections.forEach((s,i)=>{
        s.classList.remove('active','prev','next');
        if(i === idx) s.classList.add('active');
        else if(i < idx) s.classList.add('prev');
        else s.classList.add('next');
      });
      currentIndex = idx;
    }
    // initial
    showSectionByIndex(0);

    // ring + click behaviors
    const ringBtn = document.getElementById('ringBtn');
    const clickRingBtn = document.getElementById('clickRingBtn');
    const pauseMarchBtn = document.getElementById('pauseMarchBtn');
    const toggleEternBtn = document.getElementById('toggleEtern');
    const marcha = document.getElementById('marcha');
    const eternamente = document.getElementById('eternamente');

    function openParents(){
      try{ marcha.pause(); }catch(e){}
      try{ eternamente.currentTime = 0; eternamente.play(); }catch(e){}
      ringBtn.classList.add('clicked'); setTimeout(()=> ringBtn.classList.remove('clicked'),900);
      showSectionByIndex(1); // go to page 2 (parents)
    }
    ringBtn && ringBtn.addEventListener('click', openParents);
    clickRingBtn?.addEventListener('click', openParents);
    pauseMarchBtn?.addEventListener('click', ()=> { try{ marcha.pause(); }catch(e){} });
    function updateToggleEtern(){ toggleEternBtn.textContent = eternamente.paused ? 'Reproducir eternamente' : 'Pausar eternamente'; }
    toggleEternBtn.addEventListener('click', ()=> {
      if(eternamente.paused) eternamente.play(); else eternamente.pause();
      updateToggleEtern();
    });
    eternamente.addEventListener('play', updateToggleEtern);
    eternamente.addEventListener('pause', updateToggleEtern);
    updateToggleEtern();

    // keyboard nav (left/right)
    window.addEventListener('keydown', (e)=>{
      if(e.key === 'ArrowRight'){ showSectionByIndex((currentIndex + 1) % sections.length); }
      else if(e.key === 'ArrowLeft'){ showSectionByIndex((currentIndex - 1 + sections.length) % sections.length); }
    });

    /* ============================
       Subtle parallax: background-position move on mouse
       Keeps light (no heavy transforms)
       ============================ */
    document.addEventListener('mousemove', (ev)=>{
      const x = ev.clientX / window.innerWidth;
      const y = ev.clientY / window.innerHeight;
      sections.forEach((s, i)=>{
        const intensity = 6 + (i % 3) * 2; // varied intensity
        s.style.backgroundPosition = `${50 + (x - 0.5) * intensity}% ${50 + (y - 0.5) * intensity}%`;
      });
    });

    /* ============================
       RSVP modal + simple local submit
       ============================ */
    const openRsvpBtn = document.getElementById('openRsvp');
    const rsvpModal = document.getElementById('rsvpModal');
    const closeRsvp = document.getElementById('closeRsvp');
    const rsvpForm = document.getElementById('rsvpForm');

    openRsvpBtn?.addEventListener('click', ()=> { rsvpModal.classList.add('open'); });
    closeRsvp?.addEventListener('click', ()=> { rsvpModal.classList.remove('open'); });
    rsvpForm?.addEventListener('submit', (e)=>{
      e.preventDefault();
      const data = new FormData(rsvpForm);
      const payload = {};
      data.forEach((v,k)=>payload[k]=v);
      // Here you can replace with fetch(...) to Google Apps Script endpoint if you want to persist.
      alert('Confirmaci√≥n enviada. Gracias, ' + (payload.name || 'invitado') + '!');
      rsvpForm.reset();
      rsvpModal.classList.remove('open');
    });

    /* ============================
       Flip countdown (animated)
       - Uses rotateX of inner card to flip
       - animateFlip triggers when value changes
       ============================ */
    const target = new Date('2025-12-28T00:00:00');

    const flipCards = {
      days: { card: document.getElementById('daysCard'), top: document.getElementById('daysTop'), bottom: document.getElementById('daysBottom') },
      hours: { card: document.getElementById('hoursCard'), top: document.getElementById('hoursTop'), bottom: document.getElementById('hoursBottom') },
      minutes: { card: document.getElementById('minutesCard'), top: document.getElementById('minutesTop'), bottom: document.getElementById('minutesBottom') },
      seconds: { card: document.getElementById('secondsCard'), top: document.getElementById('secondsTop'), bottom: document.getElementById('secondsBottom') }
    };

    function animateFlipUnit(unit, value){
      const obj = flipCards[unit];
      if(!obj) return;
      const current = obj.top.textContent;
      if(current === value) return;
      // prepare bottom with current, top becomes new, then flip
      obj.bottom.textContent = current;
      obj.top.textContent = value;
      obj.card.classList.add('flipping');
      setTimeout(()=> obj.card.classList.remove('flipping'), 650);
    }

    function updateCountdown(){
      const now = new Date();
      let diff = target - now;
      if(diff < 0) diff = 0;
      const days = Math.floor(diff / (1000*60*60*24));
      const hours = Math.floor((diff / (1000*60*60)) % 24);
      const minutes = Math.floor((diff / (1000*60)) % 60);
      const seconds = Math.floor((diff / 1000) % 60);
      animateFlipUnit('days', String(days).padStart(2,'0'));
      animateFlipUnit('hours', String(hours).padStart(2,'0'));
      animateFlipUnit('minutes', String(minutes).padStart(2,'0'));
      animateFlipUnit('seconds', String(seconds).padStart(2,'0'));
    }
    setInterval(updateCountdown, 1000);
    updateCountdown();

    /* ============================
       Carousel (page 4) ‚Äî autoplay + arrows + pause
       ============================ */
    const carouselImages = ['foto1.jpg','momento8.jpg','momento2.jpg','momento3.jpg','momento4.jpg']; // add those that exist
    let carouselIndex = 0;
    const carouselImage = document.getElementById('carouselImage');
    const carouselPrev = document.getElementById('carouselPrev');
    const carouselNext = document.getElementById('carouselNext');
    const autoplayToggle = document.getElementById('galleryAutoplayToggle');
    let carouselTimer = null;
    let autoplay = true;

    function setCarouselImage(i){
      carouselIndex = (i + carouselImages.length) % carouselImages.length;
      carouselImage.style.opacity = 0;
      setTimeout(()=> {
        carouselImage.src = carouselImages[carouselIndex];
        carouselImage.style.opacity = 1;
      }, 180);
    }
    carouselPrev?.addEventListener('click', ()=> setCarouselImage(carouselIndex - 1));
    carouselNext?.addEventListener('click', ()=> setCarouselImage(carouselIndex + 1));

    function startCarousel(){
      stopCarousel();
      carouselTimer = setInterval(()=> setCarouselImage(carouselIndex + 1), 4200);
      autoplay = true;
      if(autoplayToggle) { autoplayToggle.textContent = 'Pausar autoplay'; autoplayToggle.setAttribute('aria-pressed','true'); }
    }
    function stopCarousel(){
      if(carouselTimer) clearInterval(carouselTimer);
      carouselTimer = null;
      autoplay = false;
      if(autoplayToggle) { autoplayToggle.textContent = 'Reproducir autoplay'; autoplayToggle.setAttribute('aria-pressed','false'); }
    }
    autoplayToggle?.addEventListener('click', ()=> { if(autoplay) stopCarousel(); else startCarousel(); });

    // initialize carousel
    setCarouselImage(0);
    startCarousel();

    /* ============================
       Guest gallery placeholder (static)
       - if you host uploads via form, fetch and update here
       ============================ */

    /* ============================
       Add calendar / download PDF
       ============================ */
    document.getElementById('addCalendar')?.addEventListener('click', (e)=>{
      e.preventDefault();
      const start = '20251228T140000';
      const end = '20251228T230000';
      const title = encodeURIComponent('Boda ‚Äî Abril & Pablo');
      const details = encodeURIComponent('Ceremonia y recepci√≥n ‚Äî Abril & Pablo');
      const location = encodeURIComponent('Iglesia Cristiana Palabra de Vida AD / Jard√≠n Los Abuelos, Tlaquiltenango, Morelos');
      const url = `https://www.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${start}/${end}&details=${details}&location=${location}`;
      window.open(url, '_blank');
    });

    document.getElementById('downloadPdf')?.addEventListener('click', ()=> window.print());

    /* ============================
       Cursor hearts visual
       - spawn occasionally for performance
       ============================ */
    document.addEventListener('mousemove', (ev)=>{
      if(Math.random() > 0.6) return;
      const heart = document.createElement('div');
      heart.className = 'magicHeart';
      const size = 14 + Math.random() * 20;
      heart.style.width = heart.style.height = size + 'px';
      heart.style.left = (ev.clientX + (Math.random()*26 - 13)) + 'px';
      heart.style.top = (ev.clientY + (Math.random()*26 - 13)) + 'px';
      const r = Math.random();
      if(r < 0.25) heart.style.background = 'radial-gradient(circle,#4dc3ff,#bfeeff)';
      else if(r < 0.5) heart.style.background = 'radial-gradient(circle,#a7ffcf,#eafff0)';
      else if(r < 0.75) heart.style.background = 'radial-gradient(circle,#ffffff,#f0f0f0)';
      else heart.style.background = 'radial-gradient(circle,#c8c8c8,#ffffff)';
      heart.style.clipPath = 'polygon(50% 0%,61% 15%,75% 15%,84% 27%,84% 45%,75% 60%,50% 80%,25% 60%,16% 45%,16% 27%,25% 15%,39% 15%)';
      document.body.appendChild(heart);
      setTimeout(()=> heart.remove(), 900 + Math.random() * 800);
    });

    /* ============================
       Small accessibility: allow clicking on card to advance
       (keeps navigation accessible to keyboard too)
       ============================ */
    document.querySelectorAll('.card').forEach((c, i) => {
      c.addEventListener('dblclick', ()=> showSectionByIndex((currentIndex + 1) % sections.length));
    });

    /* ============================
       Ensure toggleEtern label correct on load
       ============================ */
    try { (function(){ if(typeof updateToggleEtern === 'function') updateToggleEtern(); })(); } catch(e){}

  </script>
</body>
</html>
 
